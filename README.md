# Stitch: Screencast Generator for CLI

This repository contains a simple tool to generate screencasts. The tool
captures terminal commands and their outputs, generating screencasts with almost
no human intervention (well, you still need to write the script).

The final output will be a 1920x1080p video.

## Dependencies

- [ffmpeg](https://ffmpeg.org): Used for video processing and encoding.
- [ffmpeg-normalize](https://github.com/slhck/ffmpeg-normalize): Used for audio
  normalization.
- [vhs](https://github.com/charmbracelet/vhs): A tool for recording terminal
  sessions.
- [ttyd](https://github.com/tsl0922/ttyd): Command-line tool for sharing
  terminal over the web
- [Ruby](https://ruby-lang.org): Required to run the screencast generation
  script.
- Node.js: Required to run the ElevenLabs API client.
- [ElevenLabs](https://elevenlabs.io/app/developers/api-keys) API key set as
  `ELEVENLABS_API_KEY` env var.

### macOS

You can use brew:

```bash
brew install ffmpeg vhs ruby nodejs
```

For ffmpeg-normalize, you can use pip:

```bash
pip install ffmpeg-normalize --user
```

## Usage

Download this script and make it executable:

```bash
curl -L https://github.com/fnando/stitch/raw/main/bin/stitch -o bin/stitch
chmod +x bin/stitch

curl -L https://github.com/fnando/stitch/raw/main/bin/stitch-voiceover -o bin/stitch-voiceover
chmod +x bin/stitch-voiceover
```

This CLI is very simple.

```bash
$ ./bin/stitch --help
Usage: bin/stitch [export|new]

$ bin/stitch export --help
Exports an episode to a final video file.

    -d, --dir=DIR                    The episode directory
    -o, --[no-]overwrite             Overwrite existing files
        --[no-]overwrite-vhs         Regenerate VHS
        --[no-]overwrite-voiceover   Regenerate voiceover
        --voiceover-output-format=FORMAT
                                     The voiceover output format

$ ./bin/stitch new --help
Creates a new episode directory.

    -t, --title=TITLE                The episode title
```

### Docker image

You can also skip the hassle of setting everything up and using and running this
through a Docker container.

```bash
$ docker run --platform=linux/amd64 --rm -v $PWD:/stitch -e ELEVENLABS_API_KEY=$ELEVENLABS_API_KEY localhost/fnando/stitch export --dir=episodes/001-your-episode
```

Notes:

- If you local directory has a `stitch_prepare.sh` file, that will be executed
  before running stitch.
- The container has `sudo` without password, so you can install any dependencies
  you need.
- Your local `bin` is added to `$PATH`.

## Anatomy of an Episode Directory

An episode directory should contain the following files:

- `scripts/`: contains all the scripts for the episode. Each paragraph should be
  its own file.
- `content/`: contains all the VHS terminal recordings, videos and images for
  the episode. Only one type can be available at a time, so if you have an image
  (`001.png`), you cannot have a video (`001.mp4`) or a tape (`001.tape`).
- `audio/`: contains all the voiceovers (.mp3 file) generated by ElevenLabs
- `setup.sh`: a script to setup the environment before running the episode.
- `title.txt`: the title of the episode. Linebreaks control how the title will
  appear.

Notes:

- When defining `content/`: videos must be 1920x1080p, while images must be
  3840x2160
- Audios must be 441000 Hz (backtrack, voiceover)
- The title will add linebreaks automatically based on word width, but you can
  control their exact placement by adding them manually in the `title.txt` file.
